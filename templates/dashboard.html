<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - Policy Pulse AI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
</head>
<body class="dashboard-body">

<div class="sidebar">
    <h2>Policy Pulse</h2>
    <a href="/dashboard">Dashboard</a>
    <a href="/upload-policy">Upload Policy</a>
    <a href="/scheme-advisor">Scheme Advisor</a>
    <a href="/logout">Logout</a>
</div>

<div class="main-content">

    <div class="dashboard-header">
        <h1>AI Policy Dashboard</h1>
        <div class="header-info">
            {{ total_policies }} Policies Analyzed
        </div>
    </div>

    <!-- Metrics -->
    <div class="metrics-grid">
        <div class="metric-card">
            <h3>Total Policies</h3>
            <div class="metric-value" id="totalCount">{{ total_policies }}</div>
        </div>

        <div class="metric-card">
            <h3>Average Impact</h3>
            <div class="metric-value">{{ average_impact }}/100</div>
        </div>

        <div class="metric-card">
            <h3>Top Keyword</h3>
            <div class="metric-value">
                {% if top_keywords %}
                    {{ top_keywords[0][0] }}
                {% else %}
                    -
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Chart -->
    <div class="chart-container">
        <h3>Sentiment Distribution</h3>
        <canvas id="sentimentChart"></canvas>
    </div>
    <script>
    let count = document.getElementById("totalCount");
    let target = parseInt(count.innerText);
    let current = 0;

    let interval = setInterval(() => {
        if(current >= target){
            clearInterval(interval);
        } else {
            current++;
            count.innerText = current;
        }
    }, 50);
    </script>

    <!-- Policies -->
    <h3>Recent Policies</h3>

    {% for policy in policies %}
        <div class="policy-card">
            <h4>{{ policy[0] }}</h4>
            <p>{{ policy[1][:200] }}...</p>
            <small>Sentiment: {{ policy[3] }}</small>
        </div>
    {% endfor %}

</div>

<script>
const ctx = document.getElementById('sentimentChart');

new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: {{ sentiment_counts.keys()|list|tojson }},
        datasets: [{
            data: {{ sentiment_counts.values()|list|tojson }},
            backgroundColor: ['#38bdf8','#f87171','#34d399','#fbbf24','#a78bfa']
        }]
    }
});
</script>

</body>
</html>